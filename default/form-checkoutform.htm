{# form CheckoutForm #}
{# for mobile detection use sd_is_mobile (uses UAParser) #}
<form action="{{ output.cart_suri }}" method="post" id="sd-payForm" name="sd_payForm"
      onsubmit="return sdValidCheckout();">
	<input type="hidden" name="do" value="process-checkout"/>

	{% if (sd_option('site_cart_checkout_confirm') == 'on') %}
		<input type="hidden" id="sd-confirm" name="confirm" value=""/>
	{% endif %}

	<input type="hidden" name="sd_js" value="jsoff"/>
	<table rules="none" cellpadding="0" cellspacing="0" id="sd-payment-info">
		<col width="1"/>
		<tr>
			<td id="sd-cartNotice">
			{% if (not data['ccerror'])  %}
				{{ sd_notice(false) }}
			{% endif %}
			</td>
		</tr>
		{# logged in form head #}
		{% if (sd_is_logged_in) %}
		<tr>
			<td>
				<b class="sd-infoBold">ADDRESS CHANGES WILL NOT UPDATE ACCOUNT DETAILS</b>
			</td>
		</tr>
		<tr>
			<td>
				<img class="sd-formIcon" src="{{ output.icons['blank'] }}" name="sdform-vemail" alt=""/>
				<input type="hidden" name="sd_email" value="{{ data['email'] }}"/>
				<input type="hidden" name="sd_cemail" value="{{ data['cemail'] }}"/>
				<img class="sd-formIcon" src="{{ output.icons['blank'] }}" name="sdform-vcemail" alt=""/>
			</td>
		</tr>
		<tr>
			<td class="sd-payInfo">
				<strong id="sd-email-acct"><label>Email</label> {{ data['email'] }}</strong>
			</td>
		</tr>
		{% endif %}
		{# end logged in form head #}

		<tr>
			<td class="sd-payInfo">
				<b class="sd-infoBold">BILLING ADDRESS</b>
				<img src="{{ output.icons['required'] }}" alt="Required"/> = REQUIRED
				<div id="sd-billingForm">
					{% include 'form-wwwcartbilling.htm' with {'data': data} %}
				</div>
			</td>
		</tr>

		{# shipping form #}
		{% if (sd_option('site_shipping') == 'on' and sd_option('shipping_address') == 'on') %}
		<tr>
			<td class="sd-payInfo">
				<b class="sd-infoBold sd-shipAddrLabel">SHIPPING ADDRESS</b>
				<br/>
				<img class="sd-formIcon" src="{{ output.icons['vform']['shiplocation'] }}" name="sdform-vsshiploc" alt="Required ship to location"/>
				<select tabindex="21" id="sd-ship-location" name="sd_ship_location" onchange="sdShipForm(this,'{{ output.buttons['form_cart_shipping'] }}','sd-shippingForm');">
					<option value="BillingAddress" {{ data['select_billing'] }}>Same As Billing Address</option>
					<option value="OtherAddress" {{ data['select_other'] }}>Other Address</option>
				</select>

				<div id="sd-shippingForm">
				{% if (data['select_other']) %}
					{% include 'form-wwwcartshipping.htm' with {'data': data} %}
				{% endif %}
			</div>
		</td>
	</tr>
	{% endif %}
	{# shipping form end #}

	{# show email inputs and create account offer #}
	{% if (sd_option('site_accounts') == 'on' and not sd_is_logged_in) %}
	<tr>
		<td class="sd-payInfo">
			<div id="sd-emailForm">
				{% include 'form-cartemail.htm' with {'data': data} %}
			</div>
		</td>
	</tr>
	<tr>
		<td class="sd-payInfo">
			<div id="sd-passForm">
				{% include 'form-cartpass.htm' with {'data': data} %}
			</div>
		</td>
	</tr>
	{# show only email inputs #}
	{% elseif (sd_option('site_accounts') != 'on') %}
	<tr>
		<td class="sd-payInfo">
			<div id="sd-emailForm">
				{%  include 'form-cartemail.htm' with {'data' : data} %}
			</div>
		</td>
	</tr>
	{% endif %}
	{# end email inputs and create account offer #}

	{# credit card country filters #}
	{% set countryfilters = sd_option('site_cart_card_countries') %}
	{% if (data['bcountry'] and sd_option('site_cart_card_filters') == 'on' and (countryfilters))  %}
		{% set cardcountries = countryfilters|split('*') %}
		{% if ((cardcountries[0] == 'ALL' and data['bcountry'] in cardcountries) or (cardcountries[0] != 'ALL' and data['bcountry'] and not incardcountries))  %}
		{% set cardnotice = 'Credit cards not accepted from ' ~ sd_countryname(data['bcountry']) %}
		<tr>
			<td class="sd-payInfo">
				<div id="sd-creditcardForm">
					<div class="sd-error" id="sd-cardNotice">{{ cardnotice  }}</div>
					<div>
						{{ output.buttons['checkout_paypal'] }}
						{{ output.buttons['checkout_google'] }}
						{{ output.buttons['checkout_dwolla'] }}
					</div>
				</div>
			</td>
		</tr>
		{% endif %}
	{% else %}
	{# credit card form and submit #}
	<tr>
		<td class="sd-payInfo">
			<div id="sd-creditcardForm">
				{% include 'form-cardcheckout.htm' with {'data': data} %}
			</div>
		</td>
	</tr>
	<!--
	<tr>
		<td id="sd-submitBlock">
			<input alt="Pay Now" class="sd-formButton" tabindex="35" id="sd-formSubmitButton" type="image" src="{{ output.icons['pay_now_cards'] }}" value="Pay Now"/>
		</td>
	</tr>
	-->
	{% endif %}
	</table>
</form>
